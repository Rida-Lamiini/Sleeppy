var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _Storage=_interopRequireDefault(require("../Storage"));var _Utils=require("../Utils");var _jsUtils=require("@kinde/js-utils");var AuthorizationCode=function(){function AuthorizationCode(){(0,_classCallCheck2["default"])(this,AuthorizationCode);}return(0,_createClass2["default"])(AuthorizationCode,[{key:"authenticate",value:(function(){var _authenticate=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(kindeSDK,startPage,additionalParameters,options){var prompt,_generateChallenge,codeChallenge,codeVerifier,state,nonce,params,authUrl;return _regenerator["default"].wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if((0,_Utils.isAdditionalParameters)(additionalParameters)){additionalParameters=(0,_Utils.additionalParametersToLoginMethodParams)(additionalParameters);}_context.t0=startPage;_context.next=_context.t0==='login'?4:_context.t0==='registration'?6:_context.t0==='none'?8:10;break;case 4:prompt=_jsUtils.PromptTypes.login;return _context.abrupt("break",10);case 6:prompt=_jsUtils.PromptTypes.create;return _context.abrupt("break",10);case 8:prompt=_jsUtils.PromptTypes.none;return _context.abrupt("break",10);case 10:_generateChallenge=(0,_Utils.generateChallenge)(),codeChallenge=_generateChallenge.codeChallenge,codeVerifier=_generateChallenge.codeVerifier,state=_generateChallenge.state;nonce=(0,_Utils.generateRandomString)();params=Object.assign({},additionalParameters,{prompt:prompt,clientId:kindeSDK.clientId,redirectURL:kindeSDK.redirectUri,scope:kindeSDK.scope.split(' '),codeChallenge:codeChallenge,nonce:nonce,state:state,codeChallengeMethod:'S256'});_context.next=15;return(0,_jsUtils.generateAuthUrl)(kindeSDK.issuer,startPage==='login'?_jsUtils.IssuerRouteTypes.login:_jsUtils.IssuerRouteTypes.register,params);case 15:authUrl=_context.sent;_Storage["default"].setState(state);_Storage["default"].setCodeVerifier(codeVerifier);_Storage["default"].setNonce(nonce);_Storage["default"].setCodeChallenge(codeChallenge);return _context.abrupt("return",(0,_Utils.OpenWebInApp)((0,_jsUtils.sanitizeUrl)(authUrl.url.toString()),kindeSDK,options));case 21:case"end":return _context.stop();}},_callee);}));function authenticate(_x,_x2,_x3,_x4){return _authenticate.apply(this,arguments);}return authenticate;}())}]);}();var _default=exports["default"]=AuthorizationCode;